var d=Object.create,a=Object.defineProperty,f=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,p=Object.getOwnPropertyNames,y=Object.getOwnPropertyDescriptor,l=e=>a(e,"__esModule",{value:!0}),w=(e,t)=>{l(e);for(var o in t)a(e,o,{get:t[o],enumerable:!0})},S=(e,t,o)=>{if(l(e),t&&typeof t=="object"||typeof t=="function")for(let r of p(t))!c.call(e,r)&&r!=="default"&&a(e,r,{get:()=>t[r],enumerable:!(o=y(t,r))||o.enumerable});return e},n=e=>e&&e.__esModule?e:S(a(e!=null?d(f(e)):{},"default",{value:e,enumerable:!0}),e);w(exports,{User:()=>v});var u=n(require("crypto")),m=n(require("jsonwebtoken")),s=n(require("mongoose")),h=n(require("mongoose-unique-validator")),g=n(require("../../utils/secrets"));const i=new s.Schema({username:{type:s.Schema.Types.String,lowercase:!0,unique:!0,required:[!0,"can't be blank"],match:[/^[a-zA-Z0-9]+$/,"is invalid"],index:!0},email:{type:s.Schema.Types.String,lowercase:!0,unique:!0,required:[!0,"can't be blank"],match:[/\S+@\S+\.\S+/,"is invalid"],index:!0},bio:{type:s.Schema.Types.String},image:{type:s.Schema.Types.String},favorites:[{type:s.Schema.Types.ObjectId,ref:"Article"}],following:[{type:s.Schema.Types.ObjectId,ref:"User"}],hash:{type:s.Schema.Types.String},salt:{type:s.Schema.Types.String}},{timestamps:!0});i.plugin(h.default,{message:"is already taken."}),i.methods.validPassword=function(e){const t=u.default.pbkdf2Sync(e,this.salt,1e4,512,"sha512").toString("hex");return this.hash===t},i.methods.setPassword=function(e){this.salt=u.default.randomBytes(16).toString("hex"),this.hash=u.default.pbkdf2Sync(e,this.salt,1e4,512,"sha512").toString("hex")},i.methods.generateJWT=function(){const e=new Date,t=new Date(e);return t.setDate(e.getDate()+60),m.default.sign({id:this._id,username:this.username,exp:t.getTime()/1e3},g.JWT_SECRET)},i.methods.toAuthJSON=function(){return{username:this.username,email:this.email,token:this.generateJWT(),bio:this.bio,image:this.image}},i.methods.toProfileJSONFor=function(e){return{username:this.username,bio:this.bio,image:this.image||"https://static.productionready.io/images/smiley-cyrus.jpg",following:e?e.isFollowing(this._id):!1}},i.methods.favorite=function(e){return this.favorites.indexOf(e)===-1&&this.favorites.push(e),this.save()},i.methods.unfavorite=function(e){return this.favorites.remove(e),this.save()},i.methods.isFavorite=function(e){return this.favorites.some(function(t){return t.toString()===e.toString()})},i.methods.follow=function(e){return this.following.indexOf(e)===-1&&this.following.push(e),this.save()},i.methods.unfollow=function(e){return this.following.remove(e),this.save()},i.methods.isFollowing=function(e){return this.following.some(function(t){return t.toString()===e.toString()})};const v=s.model("User",i);
